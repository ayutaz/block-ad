# macOS VPN サポート

AdBlock は macOS でもシステム全体の広告ブロックを提供します。

## 機能

- **システム全体の広告ブロック**: すべてのアプリケーションで広告をブロック
- **DNS フィルタリング**: DNS レベルで広告ドメインをブロック
- **パケットフィルタリング**: ネットワークパケットレベルでの広告ブロック
- **統計情報**: ブロックした広告数やデータ節約量を表示

## 必要な環境

- macOS 11.0 (Big Sur) 以降
- Apple Developer アカウント（System Extension の署名に必要）

## インストール

### 初回起動時

1. AdBlock アプリを起動
2. 「VPN を有効にする」をクリック
3. System Extension のインストール許可を求められたら「許可」をクリック
4. システム環境設定 → セキュリティとプライバシー で許可
5. 必要に応じてシステムを再起動

### VPN プロファイルの設定

1. システム環境設定 → ネットワーク を開く
2. 「AdBlock Network Filter」が表示されることを確認
3. 必要に応じて設定を調整

## 使用方法

### VPN の有効化/無効化

- アプリ内のトグルスイッチで簡単に切り替え
- メニューバーアイコンからも操作可能（実装予定）

### フィルタリストの更新

- 設定画面から手動更新
- 自動更新を有効にすると定期的に更新

### カスタムルール

- 設定 → カスタムルール から独自のブロックルールを追加
- EasyList 形式のルールをサポート

## トラブルシューティング

### System Extension がインストールできない

1. システム環境設定 → セキュリティとプライバシー を確認
2. 「一般」タブで「許可」ボタンをクリック
3. それでも動作しない場合は、ターミナルで以下を実行：
   ```bash
   systemextensionctl list
   ```

### VPN が接続されない

1. Console.app でログを確認
2. `com.adblock.app` または `com.adblock.networkextension` でフィルタリング
3. エラーメッセージを確認

### 広告がブロックされない

1. VPN が有効になっているか確認
2. フィルタリストが最新か確認
3. 特定のサイトで問題がある場合は、カスタムルールを追加

## 技術仕様

### System Extension

macOS 版 AdBlock は System Extension を使用してネットワークトラフィックをフィルタリングします。

- **Packet Tunnel Provider**: すべてのネットワークトラフィックを処理
- **DNS インターセプト**: DNS クエリをリアルタイムで処理
- **低レベルフィルタリング**: IP レベルでのブロック

### セキュリティ

- ローカル VPN として動作（外部サーバーには接続しません）
- すべての処理はデバイス上で実行
- プライバシーを保護

## 既知の問題

- Mac App Store では配布できません（System Extension の制限）
- 初回インストール時に再起動が必要な場合があります
- 一部の企業ネットワークでは動作しない可能性があります

## 今後の予定

- [ ] メニューバーアプリの実装
- [ ] より詳細な統計情報
- [ ] ホワイトリスト機能
- [ ] アプリごとのフィルタリング設定